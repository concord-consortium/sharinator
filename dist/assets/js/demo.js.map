{"version":3,"sources":["webpack:///./src/demo.tsx","webpack:///./src/components/demo.tsx?4894","webpack:///./src/components/iframe.tsx?b0d9","webpack:///./src/components/iframe-sidebar.tsx?4ca0"],"names":[],"mappings":"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","file":"demo.js","sourcesContent":["import * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport { Demo } from \"./components/demo\"\n\nReactDOM.render(\n    <Demo />,\n    document.getElementById(\"app\")\n);\n\n\n// WEBPACK FOOTER //\n// ./src/demo.tsx","import * as React from \"react\";\nimport { IFrameSidebar } from \"./iframe-sidebar\"\nimport { parseURLIntoAuthoredState, AuthoredState } from \"./iframe\"\nimport { ClassInfoResultResponse, User } from \"./class-info\"\nconst queryString = require(\"query-string\")\nconst superagent = require(\"superagent\")\n\nconst UID_LENGTH = 40\n\ndeclare var firebase: any  // @types/firebase is not Firebase 3\n\nexport interface DemoProps {\n}\n\nexport interface DemoState {\n  error: string|null\n  codapURL: string\n  numTeachers: number\n  numStudents: number\n  demoUID: string|null\n  demo?: FirebaseDemo\n}\n\nexport interface DemoUser {\n  name: string\n  type: \"student\"|\"teacher\"\n  email: string\n  index: number\n  interactiveState: any\n}\n\nexport interface DemoUserMap {\n  [key: string]: DemoUser\n}\n\nexport interface FirebaseDemo {\n  authoredState: AuthoredState,\n  users: DemoUserMap,\n  classInfo: ClassInfoResultResponse\n}\n\nexport function getParam(name:string):string {\n  let value = \"\"\n  const params = (window.location.search.substr(1) || \"\").split(\"&\")\n  params.forEach((param) => {\n    const [key, keyValue, ...rest] = param.split(\"=\")\n    if (key === name) {\n      value = keyValue\n    }\n  })\n  return value\n}\n\nexport function generateUID():string {\n  let i = 0\n  const uid:string[] = []\n  for (i = 0; i < UID_LENGTH; i++) {\n    uid.push(String.fromCharCode(65 + (Math.random() * 26)))\n  }\n  return uid.join(\"\")\n}\n\nexport function getUID(name:string):string|null {\n  const demoParam = getParam(name)\n  return demoParam.length === UID_LENGTH ? demoParam : null\n}\n\nexport class Demo extends React.Component<DemoProps, DemoState> {\n\n  refs: {\n    codapURL: HTMLInputElement\n    numTeachers: HTMLInputElement\n    numStudents: HTMLInputElement\n  }\n\n  constructor(props: DemoProps) {\n    super(props)\n    const demoUID = getUID(\"demo\")\n    this.state = {\n      error: null,\n      codapURL: \"\",\n      numTeachers: 1,\n      numStudents: 10,\n      demoUID: demoUID,\n    }\n\n    if (demoUID) {\n      const demo = firebase.database().ref(`demos/${demoUID}`)\n      demo.once(\"value\", (snapshot:any) => {\n        const firebaseData:FirebaseDemo = snapshot.val()\n        this.setState({demo: firebaseData})\n      })\n    }\n  }\n\n  numberChanged(e: React.ChangeEvent<HTMLInputElement>, input:HTMLInputElement) {\n    const intValue = e.currentTarget.value === \"\" ? 0 : parseInt(e.currentTarget.value, 10)\n    if (!isNaN(intValue)) {\n      if (input === this.refs.numTeachers) {\n        this.setState({numTeachers: intValue})\n      }\n      else {\n        this.setState({numStudents: intValue})\n      }\n    }\n  }\n\n  formSubmitted(e:React.FormEvent<HTMLFormElement>) {\n    e.preventDefault()\n    const codapURL = this.refs.codapURL.value\n    try {\n      const authoredState = parseURLIntoAuthoredState(codapURL)\n      const demoUID = generateUID()\n      const users:DemoUserMap = {}\n      const teachers:User[] = []\n      const students:User[] = []\n      let i = 0\n\n      for (i = 0; i < this.state.numTeachers; i++) {\n        const userUID = generateUID()\n        users[generateUID()] = {\n          index: i,\n          type: \"teacher\",\n          name: `Teacher ${i+1}`,\n          email: `teacher${i+1}@example.com`,\n          interactiveState: null\n        }\n        teachers.push({\n          first_name: \"Teacher\",\n          last_name: `${i+1}`,\n          email: `teacher${i+1}@example.com`\n        })\n      }\n\n      for (i = 0; i < this.state.numStudents; i++) {\n        users[generateUID()] = {\n          index: i,\n          type: \"student\",\n          name: `Student ${i+1}`,\n          email: `student${i+1}@example.com`,\n          interactiveState: null\n        }\n        students.push({\n          first_name: \"Student\",\n          last_name: `${i+1}`,\n          email: `student${i+1}@example.com`\n        })\n      }\n\n      const classInfo:ClassInfoResultResponse = {\n        name: `Demo ${demoUID}`,\n        class_hash: demoUID,\n        students: students,\n        teachers: teachers\n      }\n\n      const demo = firebase.database().ref(`demos/${demoUID}`)\n      const demoInfo:FirebaseDemo = {\n        authoredState: authoredState,\n        users: users,\n        classInfo: classInfo\n      }\n      demo.set(demoInfo, () => {\n        window.location.href = `?demo=${demoUID}`\n      })\n    }\n    catch (e) {\n      this.setState({error: e.message})\n    }\n  }\n\n  renderLinks() {\n    if (!this.state.demo) {\n      return <div>Loading...</div>\n    }\n\n    const users = this.state.demo.users\n    const teacherLinks:JSX.Element[] = []\n    const studentLinks:JSX.Element[] = []\n    let i = 0;\n\n    Object.keys(users).forEach((userUID) => {\n      const user = users[userUID]\n      const link = <li key={userUID}><a href={`../iframe/?demo=${this.state.demoUID}&demoUser=${userUID}`} target=\"_blank\">{user.name}</a></li>\n      if (user.type === \"teacher\") {\n        teacherLinks[user.index] = link\n      }\n      else {\n        studentLinks[user.index] = link\n      }\n    })\n\n    return (\n      <div>\n        <h1>Demo Links</h1>\n        <h2>Teachers</h2>\n        <ul>{teacherLinks}</ul>\n        <h2>Students</h2>\n        <ul>{studentLinks}</ul>\n      </div>\n    )\n  }\n\n  renderForm() {\n    return (\n      <form onSubmit={this.formSubmitted.bind(this)}>\n        <h1>Demo Creator</h1>\n        {this.state.error ? <div className=\"error\">{this.state.error}</div> : null}\n        <label htmlFor=\"codapURL\">CODAP Lara Sharing URL</label>\n        <input type=\"text\" ref=\"codapURL\" placeholder=\"url here...\" defaultValue={this.state.codapURL} />\n        <label htmlFor=\"numTeachers\">Number of Teachers</label>\n        <input type=\"text\" ref=\"numTeachers\" value={this.state.numTeachers > 0 ? this.state.numTeachers : \"\"} onChange={(e) => this.numberChanged(e, this.refs.numTeachers)} />\n        <label htmlFor=\"numStudents\">Number of Students</label>\n        <input type=\"text\" ref=\"numStudents\" value={this.state.numStudents > 0 ? this.state.numStudents : \"\"} onChange={(e) => this.numberChanged(e, this.refs.numStudents)} />\n        <div>\n          <input type=\"submit\" value=\"Create Demo\" />\n        </div>\n      </form>\n    )\n  }\n\n  render() {\n    if (this.state.demoUID) {\n      return this.renderLinks()\n    }\n    return this.renderForm()\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/demo.tsx","import * as React from \"react\";\nimport { IFrameSidebar } from \"./iframe-sidebar\"\nimport { getParam, getUID, FirebaseDemo } from \"./demo\"\n\nconst queryString = require(\"query-string\")\nconst superagent = require(\"superagent\")\nconst base64url = require(\"base64-url\")\n\ndeclare var iframePhone: any\ndeclare var firebase: any  // @types/firebase is not Firebase 3\n\nexport interface IFrameProps {\n}\n\nexport interface IFrameState {\n  src: string|null\n  irsUrl: string|null\n  copyUrl: string|null\n  authoring: boolean,\n  authoredState: AuthoredState|null,\n  authoringError: string|null\n  initInteractiveData: InitInteractiveData|null\n  demoUID: string|null\n  demoUser?: string\n  codapPhone:any\n}\n\nexport interface AuthoredState {\n  laraSharedUrl: string\n  docStoreUrl: string\n  codapUrl: string\n  codapParams: any\n  documentId: string\n}\n\nexport interface InteractiveRunStateData {\n  docStoreUrl: string\n  copyUrl: string\n}\n\nexport interface InitInteractiveData {\n  version: number\n  error: string|null\n  mode: \"authoring\"|\"runtime\"\n  authoredState: AuthoredState|string\n  interactiveState: any|null\n  globalInteractiveState: any|null\n  hasLinkedInteractive: boolean\n  linkedState: any|null\n  interactiveStateUrl: string\n  collaboratorUrls: string|null\n  publicClassHash: string|null\n  classInfoUrl: string|null\n  interactive: InitInteractiveInteractiveData\n  authInfo: InitInteractiveAuthInfoData\n}\n\nexport interface InitInteractiveInteractiveData {\n  id: number\n  name: string\n}\nexport interface InitInteractiveAuthInfoData {\n  provider: string\n  loggedIn: boolean\n  email: string\n}\n\nexport class IFrame extends React.Component<IFrameProps, IFrameState> {\n  private classroomRef:any\n  private clientPhone:any\n  private iframeCanAutosave = false\n\n  refs: {\n    [string: string]: any;\n    iframe: HTMLIFrameElement;\n    laraSharedUrl: HTMLInputElement;\n  }\n\n  constructor(props: IFrameProps) {\n    super(props)\n\n    this.submitAuthoringInfo = this.submitAuthoringInfo.bind(this)\n    this.getInteractiveState = this.getInteractiveState.bind(this)\n    this.setupNormalMode = this.setupNormalMode.bind(this)\n\n    const demoUID = getUID(\"demo\")\n    const demoUser = getParam(\"demoUser\")\n\n    this.state = {\n      irsUrl: null,\n      src: null,\n      authoring: false,\n      authoredState: null,\n      authoringError: null,\n      initInteractiveData: null,\n      copyUrl: null,\n      demoUID: demoUID,\n      demoUser: demoUser,\n      codapPhone: null\n    }\n  }\n\n  componentDidMount() {\n    if (this.state.demoUID) {\n      this.setupDemoMode()\n    }\n    else {\n      // TODO: figure out why iframe phone needs the delay\n      setTimeout(this.setupNormalMode, 1000)\n    }\n  }\n\n  generateIframeSrc(initInteractiveData:InitInteractiveData) {\n    const authoredState:AuthoredState = initInteractiveData.authoredState as AuthoredState\n    const launchParams:any = {url: initInteractiveData.interactiveStateUrl, source: authoredState.documentId, collaboratorUrls: initInteractiveData.collaboratorUrls}\n    const linkedState = initInteractiveData.linkedState || {}\n    const interactiveRunState = initInteractiveData.interactiveState || {}\n    const codapParams = authoredState.codapParams || {}\n\n    // if there is a linked state and no interactive state then change the source document to point to the linked recordid and add the access key\n    if (linkedState.docStore && linkedState.docStore.recordid && linkedState.docStore.accessKeys && linkedState.docStore.accessKeys.readOnly && !(interactiveRunState && interactiveRunState.docStore && interactiveRunState.docStore.recordid)) {\n      launchParams.source = linkedState.docStore.recordid;\n      launchParams.readOnlyKey = linkedState.docStore.accessKeys.readOnly;\n    }\n\n    //codapParams.componentMode = \"yes\"\n    codapParams.embeddedServer = \"yes\"\n    codapParams.documentServer = authoredState.docStoreUrl\n    codapParams.launchFromLara = base64url.encode(JSON.stringify(launchParams))\n\n    return `${authoredState.codapUrl}?${queryString.stringify(codapParams)}`\n  }\n\n  setupDemoMode() {\n    const demoRef = firebase.database().ref(`demos/${this.state.demoUID}`)\n    demoRef.once(\"value\", (snapshot:any) => {\n      const demo:FirebaseDemo = snapshot.val()\n      const demoParams = `demo=${this.state.demoUID}&demoUser=${this.state.demoUser}`\n      const demoAPIUrl = (endPoint:string) => `https://us-central1-classroom-sharing.cloudfunctions.net/${endPoint}?${demoParams}`\n      const email = this.state.demoUser ? demo.users[this.state.demoUser].email : \"no-email@example.com\"\n      const initInteractiveData:InitInteractiveData = {\n        version: 1,\n        error: null,\n        mode: \"runtime\",\n        authoredState: demo.authoredState,\n        interactiveState: null,\n        globalInteractiveState: null,\n        hasLinkedInteractive: false,\n        linkedState: null,\n        interactiveStateUrl: demoAPIUrl(\"demoInteractiveRunState\"),\n        collaboratorUrls: null,\n        publicClassHash: this.state.demoUID,\n        classInfoUrl: demoAPIUrl(\"demoClassInfo\"),\n        interactive: {id: 1, name: \"demo\"},\n        authInfo: {provider: \"demo\", loggedIn: true, email: email}\n      }\n      this.setState({\n        src: this.generateIframeSrc(initInteractiveData),\n        irsUrl: demoAPIUrl(\"demoInteractiveRunState\"),\n        initInteractiveData: initInteractiveData,\n        authoredState: demo.authoredState\n      })\n      setTimeout(this.getInteractiveState, 10);\n    })\n  }\n\n  setupNormalMode() {\n    this.clientPhone = iframePhone.getIFrameEndpoint()\n    this.clientPhone.addListener('initInteractive', (initInteractiveData:InitInteractiveData) => {\n      let authoredState:AuthoredState|null = null\n      if (typeof initInteractiveData.authoredState === \"string\") {\n        try {\n          authoredState = JSON.parse(initInteractiveData.authoredState as string)\n        }\n        catch (e) {}\n      }\n      else {\n        authoredState = initInteractiveData.authoredState;\n      }\n      if (initInteractiveData.mode === \"authoring\") {\n        this.setState({\n          authoring: true,\n          authoredState: authoredState\n        })\n        return\n      }\n\n      this.setState({\n        src: this.generateIframeSrc(initInteractiveData),\n        irsUrl: initInteractiveData.interactiveStateUrl,\n        initInteractiveData: initInteractiveData,\n        authoredState: authoredState\n      })\n\n      if (initInteractiveData.interactiveStateUrl)  {\n        setTimeout(this.getInteractiveState, 1000)\n      }\n    })\n    this.clientPhone.addListener('getInteractiveState', () => {\n      if (this.iframeCanAutosave) {\n        this.postMessageToInnerIframe('cfm::autosave');\n      }\n      else {\n        this.clientPhone.post('interactiveState', 'nochange');\n      }\n    });\n    this.clientPhone.initialize();\n    this.clientPhone.post('supportedFeatures', {\n      apiVersion: 1,\n      features: {\n        authoredState: true,\n        interactiveState: true\n      }\n    })\n  }\n\n  postMessageToInnerIframe(type:string) {\n    if (this.refs.iframe) {\n      this.refs.iframe.contentWindow.postMessage({type: type}, '*')\n    }\n  }\n\n  codapPhoneHandler(command:any, callback:Function) {\n    var success = false;\n    if (command) {\n      console.log('COMMAND!', command)\n      switch (command.message) {\n        case \"codap-present\":\n          success = true;\n          break;\n      }\n    }\n    callback({success: success});\n  }\n\n  componentDidUpdate() {\n    if (this.state.authoring) {\n      this.refs.laraSharedUrl.focus()\n    }\n    else if (this.refs.iframe && !this.state.codapPhone) {\n      this.setState({codapPhone: new iframePhone.IframePhoneRpcEndpoint(this.codapPhoneHandler.bind(this), \"data-interactive\", this.refs.iframe)});\n\n      // setup a generic postmessage CFM listener for the iframed CODAP window\n      let keepPollingForCommands = true\n      window.onmessage = (e) => {\n        switch (e.data.type) {\n          case \"cfm::commands\":\n            this.iframeCanAutosave = e.data.commands && e.data.commands.indexOf('cfm::autosave') !== -1\n            keepPollingForCommands = false\n            break\n          case \"cfm::autosaved\":\n            if (this.clientPhone) {\n              this.clientPhone.post('interactiveState', 'nochange')\n            }\n            break\n        }\n      }\n\n      // keep asking for the cfm commands available until we get a response once the inner iframe loads\n      const pollForCommandList = () => {\n        if (keepPollingForCommands) {\n          this.postMessageToInnerIframe('cfm::getCommands')\n          setTimeout(pollForCommandList, 100)\n        }\n      }\n      pollForCommandList()\n    }\n  }\n\n  getInteractiveState() {\n    const iframe = this\n    superagent\n      .get(this.state.irsUrl)\n      .withCredentials()\n      .set('Accept', 'application/json')\n      .end((err:any, res:any) => {\n        if (!err) {\n          try {\n            const json = JSON.parse(res.text)\n            if (json && json.raw_data) {\n              const rawData = JSON.parse(json.raw_data)\n              if (rawData && rawData.docStore && rawData.docStore.accessKeys && rawData.docStore.accessKeys.readOnly && this.state.authoredState) {\n                iframe.setState({\n                  copyUrl: `${this.state.authoredState.docStoreUrl}/v2/documents?source=${rawData.docStore.recordid}&accessKey=RO::${rawData.docStore.accessKeys.readOnly}`,\n                })\n              }\n              return\n            }\n          }\n          catch (e) {}\n          setTimeout(this.getInteractiveState, 1000)\n        }\n      });\n  }\n\n  submitAuthoringInfo(e:React.FormEvent<HTMLFormElement>) {\n    e.preventDefault()\n    try {\n      const authoredState = parseURLIntoAuthoredState(this.refs.laraSharedUrl.value)\n      this.setState({authoringError: null})\n      this.clientPhone.post('authoredState', authoredState)\n    }\n    catch (e) {\n      this.setState({authoringError: e.message})\n    }\n  }\n\n  renderAuthoring():JSX.Element {\n    const inputStyle = {width: \"100%\"}\n    const errorStyle = {color: \"#f00\", marginTop: 10, marginBottom: 10}\n    const url = (this.state.authoredState ? this.state.authoredState.laraSharedUrl : \"\") || \"\"\n    return <form onSubmit={this.submitAuthoringInfo}>\n             {this.state.authoringError ? <div style={errorStyle}>{this.state.authoringError}</div> : null}\n             <label htmlFor=\"laraSharedUrl\">Shared URL from LARA tab in CODAP</label>\n             <input type=\"text\" id=\"laraSharedUrl\" ref=\"laraSharedUrl\" style={inputStyle} defaultValue={url} />\n             <input type=\"submit\" value=\"Save\" />\n           </form>\n  }\n\n  renderIFrame():JSX.Element|null {\n    if (this.state.src && this.state.initInteractiveData) {\n      return <div>\n              <div id=\"iframe-container\">\n                <iframe ref=\"iframe\" src={this.state.src}></iframe>\n              </div>\n              <IFrameSidebar initInteractiveData={this.state.initInteractiveData} copyUrl={this.state.copyUrl} authoredState={this.state.authoredState} codapPhone={this.state.codapPhone} />\n            </div>\n    }\n    return null\n  }\n\n  render() {\n    if (this.state.authoring) {\n      return this.renderAuthoring()\n    }\n    return this.renderIFrame()\n  }\n}\n\nexport function parseURLIntoAuthoredState(url:string) {\n  const [docStoreUrl, urlQuery, ...restOfUrl] = url.split(\"?\")\n  const urlMatches = docStoreUrl.match(/^(https?:\\/\\/[^/]+\\/)v2\\/documents\\/(\\d+)\\/(auto)?launch/)\n  const launchParams = queryString.parse(urlQuery || \"\")\n\n  if (!urlMatches || !launchParams.server) {\n    throw new Error(\"This URL does not appear to be a shared URL from the LARA tab in CODAP\")\n  }\n\n  const [codapUrl, serverQuery, ...restOfServer] = launchParams.server.split(\"?\")\n  const codapParams = queryString.parse(serverQuery || \"\")\n\n  const matchProtocol = (url:string):string => {\n    const a = document.createElement(\"a\")\n    a.href = url\n    a.protocol = location.protocol\n    return a.href\n  }\n\n  const authoredState:AuthoredState = {\n    laraSharedUrl: url,\n    docStoreUrl: matchProtocol(urlMatches[1].replace(/\\/+$/, \"\")), // remove trailing slashes\n    codapUrl: matchProtocol(codapUrl),\n    codapParams: codapParams,\n    documentId: urlMatches[2]\n  }\n\n  return authoredState\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/components/iframe.tsx","import * as React from \"react\";\nimport {InitInteractiveData, AuthoredState} from \"./iframe\"\nimport {ExportLibrary} from \"./export-library\"\nimport {FirebaseInteractive, FirebaseUserInteractive, FirebaseDataContextRefMap, FirebaseData, FirebaseDataContext} from \"./types\"\nimport {ClassInfo, GetUserName} from \"./class-info\"\nimport escapeFirebaseKey from \"./escape-firebase-key\"\n\nconst queryString = require(\"query-string\")\nconst base64url = require(\"base64-url\")\nconst superagent = require(\"superagent\")\n\ndeclare var firebase: any;  // @types/firebase is not Firebase 3\n\nconst mergedUserCollectionName = \"Merged\"\nconst mergedUserCollectionTitle = \"Merged\"\nconst mergedUserAttributeName = \"User\"\nconst mergedUserAttributeTitle = \"User\"\nconst mergedEmailAttributeName = \"Email\"\nconst mergedEmailAttributeTitle = \"Email\"\n\nexport interface IFrameSidebarProps {\n  initInteractiveData: InitInteractiveData\n  authoredState: AuthoredState|null\n  copyUrl: string|null\n  codapPhone: any|null\n}\n\nexport interface IFrameSidebarState {\n  error: string|null\n  classHash: string|null\n  publishing: boolean\n  publishingError: string|null\n  publishingStatus: string|null\n  userInteractives: PublishedUserInteractives[]\n  myEmail: string\n}\n\ninterface CopyResults {\n  status: string\n  valid: boolean\n  id: number\n  readAccessKey: string\n  readWriteAccessKey: string\n}\n\nexport interface PublishedUserInteractives {\n  email: string\n  name: string|null\n  type: \"teacher\" | \"student\"\n  userInteractives: FirebaseUserInteractive[]\n}\n\nexport interface UserInteractivesProps {\n  userInteractives: PublishedUserInteractives\n  classHash: string\n  interactiveId: number\n  email: string\n  codapPhone: any\n  initInteractiveData: any\n  myEmail: string\n  classInfo: ClassInfo\n}\n\nexport interface UserInteractivesState {\n  showAll: boolean\n}\n\nexport class UserInteractives extends React.Component<UserInteractivesProps, UserInteractivesState> {\n  constructor(props: UserInteractivesProps) {\n    super(props)\n    this.state = {\n      showAll: false\n    }\n    this.toggleShowAll = this.toggleShowAll.bind(this)\n  }\n\n  toggleShowAll() {\n    this.setState({showAll: !this.state.showAll})\n  }\n\n  getVersion(index:number) {\n    return this.props.userInteractives.userInteractives.length - index\n  }\n\n  renderAll() {\n    if (!this.state.showAll) {\n      return null\n    }\n    const {userInteractives} = this.props\n    return this.props.userInteractives.userInteractives.slice(1).map((userInteractive, index) => {\n      return (\n        <UserInteractive\n          key={userInteractive.createdAt}\n          userInteractive={userInteractive}\n          version={this.getVersion(index + 1)}\n          classHash={this.props.classHash}\n          interactiveId={this.props.interactiveId}\n          initInteractiveData={this.props.initInteractiveData}\n          email={this.props.userInteractives.email}\n          codapPhone={this.props.codapPhone}\n          first={false}\n          myEmail={this.props.myEmail}\n          classInfo={this.props.classInfo}\n         />\n      )\n    })\n  }\n\n  render() {\n    const {userInteractives} = this.props\n    const hasMoreThanOne = userInteractives.userInteractives.length > 1\n    return (\n      <div className=\"user-interactives\">\n        <div className=\"user-interactives-name\" onClick={this.toggleShowAll}>\n          {userInteractives.name}\n        </div>\n        <UserInteractive\n          userInteractive={userInteractives.userInteractives[0]}\n          version={this.getVersion(0)}\n          classHash={this.props.classHash}\n          interactiveId={this.props.interactiveId}\n          email={this.props.email}\n          codapPhone={this.props.codapPhone}\n          first={true}\n          initInteractiveData={this.props.initInteractiveData}\n          myEmail={this.props.myEmail}\n          classInfo={this.props.classInfo}\n        />\n        {this.renderAll()}\n      </div>\n    )\n  }\n}\n\nexport interface UserInteractiveProps {\n  userInteractive: FirebaseUserInteractive\n  version: number\n  classHash: string\n  interactiveId: number\n  email: string\n  codapPhone: any\n  first: boolean\n  initInteractiveData: any\n  myEmail: string\n  classInfo: ClassInfo\n}\n\nexport interface UserInteractiveState {\n}\n\nexport class UserInteractive extends React.Component<UserInteractiveProps, UserInteractiveState> {\n  constructor(props: UserInteractiveProps) {\n    super(props)\n    this.state = {\n    }\n  }\n\n  renderCreatedAt() {\n    const now = (new Date()).getTime()\n    const diff = Math.max(now - this.props.userInteractive.createdAt, 0) / 1000\n    const plural = (count:number) => count === 1 ? \"\" : \"s\"\n    let when:string = \"Just now\"\n    if (diff > 59) {\n      if (diff < 60*60) {\n        const minutes = Math.round(diff/60)\n        when = `${minutes} minute${plural(minutes)} ago`\n      }\n      else if (diff < 60*60*24) {\n        const hours = Math.round(diff/(60*60))\n        when = `${hours} hour${plural(hours)} ago`\n      }\n      else {\n        const days = Math.round(diff/(60*60*24))\n        when = `${days} day${plural(days)} ago`\n      }\n    }\n    return <div className=\"user-interactive-created-at\">{when}</div>\n  }\n\n  render() {\n    const {userInteractive} = this.props\n    return (\n      <div className={`user-interactive ${!this.props.first ? 'user-interactive-with-border' : ''}`}>\n        <UserInteractiveDocument\n          userInteractive={userInteractive}\n          version={this.props.version}\n          classHash={this.props.classHash}\n          interactiveId={this.props.interactiveId}\n          initInteractiveData={this.props.initInteractiveData}\n          email={this.props.email}\n        />\n        {Object.keys(userInteractive.dataContexts).map((firebaseId) => {\n          return (\n            <UserInteractiveDataContext\n              key={firebaseId}\n              dataContextId={firebaseId}\n              dataContextName={userInteractive.dataContexts[firebaseId]}\n              version={this.props.version}\n              classHash={this.props.classHash}\n              interactiveId={this.props.interactiveId}\n              email={this.props.email}\n              codapPhone={this.props.codapPhone}\n              myEmail={this.props.myEmail}\n              classInfo={this.props.classInfo}\n            />\n          )\n        })}\n        {this.renderCreatedAt()}\n      </div>\n    )\n  }\n}\n\nexport interface UserInteractiveDocumentProps {\n  userInteractive: FirebaseUserInteractive\n  version: number\n  classHash: string\n  interactiveId: number\n  initInteractiveData: any\n  email: string\n}\n\nexport interface UserInteractiveDocumentState {\n  showOptions: boolean\n}\n\nexport class UserInteractiveDocument extends React.Component<UserInteractiveDocumentProps, UserInteractiveDocumentState> {\n  constructor(props: UserInteractiveDocumentProps) {\n    super(props)\n    this.state = {\n      showOptions: false\n    }\n    this.toggleShowOptions = this.toggleShowOptions.bind(this)\n    this.handleReplace = this.handleReplace.bind(this)\n  }\n\n  toggleShowOptions() {\n    this.setState({showOptions: !this.state.showOptions})\n  }\n\n  handleReplace() {\n\n  }\n\n  renderOptions() {\n    if (!this.state.showOptions) {\n      return null\n    }\n    const classUrl = base64url.encode(this.props.initInteractiveData.classInfoUrl)\n    const href = `../dashboard/?class=${classUrl}&interactive=${this.props.interactiveId}&user=${this.props.email}&createdAt=${this.props.userInteractive.createdAt}`\n\n    return (\n      <div className=\"user-interactive-document-options\">\n        <a className=\"user-interactive-view-document user-interactive-option\" href={href} target=\"_blank\">View In Dashboard</a>\n        <div className=\"user-interactive-replace-document user-interactive-option\">TDB: Replace My Document</div>\n      </div>\n    )\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"user-interactive-document\" onClick={this.toggleShowOptions}>Document #{this.props.version}</div>\n        {this.renderOptions()}\n      </div>\n    )\n  }\n}\n\nexport interface UserInteractiveDataContextProps {\n  dataContextId: string\n  dataContextName: string\n  version: number\n  classHash: string\n  interactiveId: number\n  email: string\n  codapPhone: any\n  myEmail: string\n  classInfo: ClassInfo\n}\n\nexport interface UserInteractiveDataContextState {\n  showOptions: boolean\n  copyState: \"Copying...\" | \"Copied\" | \"Could not copy!\" | null\n  mergeState: \"Merging...\" | \"Merged\" | \"Could not merge!\" | null\n  dataContext: any\n}\n\nexport class UserInteractiveDataContext extends React.Component<UserInteractiveDataContextProps, UserInteractiveDataContextState> {\n  private loading = false\n  private tree:any = null\n\n  constructor(props: UserInteractiveDataContextProps) {\n    super(props)\n    this.state = {\n      showOptions: false,\n      copyState: null,\n      mergeState: null,\n      dataContext: null\n    }\n    this.toggleShowOptions = this.toggleShowOptions.bind(this)\n    this.handleCopy = this.handleCopy.bind(this)\n    this.handleMerge = this.handleMerge.bind(this)\n  }\n\n  loadDataContext() {\n    if (!this.loading && (this.state.dataContext === null)) {\n      this.loading = true\n      const dataContextRef = firebase.database().ref(`dataContexts/${this.props.classHash}/${this.props.email}/interactive_${this.props.interactiveId}/${this.props.dataContextId}`)\n      dataContextRef.once(\"value\", (snapshot:any) => {\n        try {\n          // convert to a tree\n          const tree:any = {}\n          const leaves:any = {}\n          const dataContext:any = JSON.parse(snapshot.val())\n          Object.keys(dataContext.cases).forEach((id) => {\n            const _case:any = dataContext.cases[id]\n            const parent = _case.parent ? leaves[_case.parent] : null\n            const leaf = {\n              values: _case.values,\n              collection: dataContext.collections[_case.collection].name,\n              children: {},\n              parent: parent\n            }\n            leaves[id] = leaf\n            if (parent) {\n              parent.children[id] = leaf\n            }\n            else {\n              tree[id] = leaf\n            }\n          })\n\n          this.tree = tree\n          this.setState({dataContext: dataContext})\n        }\n        catch (e) {\n\n        }\n      })\n    }\n  }\n\n  toggleShowOptions() {\n    this.loadDataContext()\n    this.setState({showOptions: !this.state.showOptions})\n  }\n\n  handleMerge() {\n    const dataContextName = this.state.dataContext.name\n\n    this.setState({mergeState: \"Merging...\"})\n\n    const merge = () => {\n      addOrClearMergedUser((parentId, childrenToRemove) => {\n        addCases(this.tree, parentId, () => {\n          removeCases(childrenToRemove, () => {\n            this.setState({mergeState: \"Merged\"})\n            setTimeout(() => {\n              this.setState({mergeState: null})\n            }, 2000)\n          })\n        })\n      })\n    }\n\n    const removeCases = (cases:any[], callback:Function) => {\n      if (cases.length > 0) {\n        const actions = cases.map((_case:any) => {\n          return {\n            action: 'delete',\n            resource: `dataContext[${dataContextName}].collection[${_case.collection.name}].caseByID[${_case.id}]`\n          }\n        })\n        this.props.codapPhone.call(actions, (result:any) => {\n          callback()\n        });\n      }\n      else {\n        callback()\n      }\n    }\n\n    const addOrClearMergedUser = (callback:(parentId:number, childrenToRemove:any[]) => void) => {\n      const createNewMergedUser = (childrenToRemove:number[]) => {\n        const values:any = {}\n        const them = this.props.classInfo.getUserName(this.props.email)\n        values[mergedUserAttributeName] = them.found ? them.name : this.props.email\n        values[mergedEmailAttributeName] = this.props.email\n\n        this.props.codapPhone.call({\n          action: 'create',\n          resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}].case`,\n          values: [{\n            parent: null,\n            values: values\n          }]\n        }, (result:any) => {\n          callback(result.values[0].id, childrenToRemove)\n        })\n      }\n\n      this.props.codapPhone.call({\n        action: 'get',\n        resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}].caseSearch[${mergedEmailAttributeName}==${this.props.email}]`\n      }, (result:any) => {\n        if (result.success && (result.values.length > 0)) {\n          var parentId = result.values[0].id\n          this.props.codapPhone.call({\n            action: 'get',\n            resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}].caseByID[${parentId}]`\n          }, (result:any) => {\n            const actions = result.values.case.children.map((childId:number) => {\n              return {\n                action: 'get',\n                resource: `dataContext[${dataContextName}].caseByID[${childId}]`\n              }\n            })\n            this.props.codapPhone.call(actions, (result:any) => {\n              const casesToDelete = result.map((result:any) => result.values.case)\n              callback(parentId, result.map((result:any) => result.values.case))\n            })\n          })\n        }\n        else {\n          createNewMergedUser([])\n        }\n      })\n    }\n\n    const addCases = (branch:any, parentId:number, callback:Function) => {\n      const atRoot = branch === this.tree\n      const cases = Object.keys(branch).map((id) => branch[id])\n\n      const checkIfDone = () => {\n        if (atRoot) {\n          callback()\n        }\n      }\n\n      const addEachCase = () => {\n        if (cases.length === 0) {\n          checkIfDone()\n        }\n        else {\n          const _case = cases.shift()\n          this.props.codapPhone.call({\n            action: 'create',\n            resource: `dataContext[${dataContextName}].collection[${_case.collection}].case`,\n            values: {\n              parent: parentId,\n              values: _case.values\n            }\n          }, (result:any) => {\n            addCases(_case.children, result.values[0].id, callback)\n            addEachCase()\n          })\n        }\n      }\n\n      const addAllCases = () => {\n        const values = cases.map((_case) => { return { parent: parentId, values: _case.values }})\n        this.props.codapPhone.call({\n          action: 'create',\n          resource: `dataContext[${dataContextName}].collection[${cases[0].collection}].case`,\n          values: values\n        }, (result:any) => {\n          checkIfDone()\n        })\n      }\n\n      const processCases = () => {\n        if (cases.length === 0) {\n          checkIfDone()\n        }\n        else {\n          if (Object.keys(cases[0].children).length > 0) {\n            // case has children so we need to add each case one and a time to get the id\n            addEachCase()\n          }\n          else {\n            // no children so we can bulk add all the cases\n            addAllCases()\n          }\n        }\n      }\n\n      processCases()\n    }\n\n    const addUserAttribute = (callback:() => void) => {\n      const { collections } = this.state.dataContext\n      const collectionNames:string[] = Object.keys(collections).map((id) => collections[id].name)\n\n      //FIXME: only add the attribute to the \"leaf\" collection\n\n      const addUserAttributeToCollection = () => {\n        if (collectionNames.length === 0) {\n          callback()\n        }\n        else {\n          const collectionName = collectionNames.shift()\n          // create the merge attribute\n          this.props.codapPhone.call({\n            action: 'create',\n            resource: `dataContext[${dataContextName}].collection[${collectionName}].attribute`,\n            values: {\n              name: mergedUserAttributeName,\n              title: mergedUserAttributeTitle\n            }\n          }, (result:any) => {\n            addUserAttributeToCollection()\n          });\n        }\n      }\n\n      addUserAttributeToCollection()\n    }\n\n    const checkIfMergedCollectionExists = (callback:(result:boolean) => void) => {\n      this.props.codapPhone.call({\n        action: 'get',\n        resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}]`\n      }, (result:any) => {\n        callback(result.success);\n      });\n    }\n\n    const createMergedCollection = (callback:() => void) => {\n      this.props.codapPhone.call({\n        action: 'create',\n        resource: `dataContext[${dataContextName}].collection`,\n        values: {\n          name: mergedUserCollectionName,\n          title: mergedUserCollectionTitle,\n          parent: \"_root_\"\n        }\n      }, (result:any) => {\n        callback()\n      })\n    }\n\n    const moveUserAttribute = (callback:() => void) => {\n      this.props.codapPhone.call({\n        action: 'update',\n        resource: `dataContext[${dataContextName}].attributeLocation[${mergedUserAttributeName}]`,\n        values: {\n          collection: mergedUserCollectionName\n        }\n      }, (result:any) => {\n        callback()\n      })\n    }\n\n    const createEmailAttribute = (callback:() => void) => {\n      this.props.codapPhone.call({\n        action: 'create',\n        resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}].attribute`,\n        values: {\n          name: mergedEmailAttributeName,\n          title: mergedEmailAttributeTitle,\n          hidden: true\n        }\n      }, (result:any) => {\n        callback()\n      });\n    }\n\n    const setUserAndEmailAttribute = (callback:() => void) => {\n      this.props.codapPhone.call({\n        action: \"get\",\n        resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}].allCases`\n      }, (result:any) => {\n        const values:any = {}\n        const me = this.props.classInfo.getUserName(this.props.myEmail)\n        values[mergedUserAttributeName] = me.found ? me.name : this.props.myEmail\n        values[mergedEmailAttributeName] = this.props.myEmail\n        const requests = result.values.cases.map((_case:any) => {\n          return {\n            action: 'update',\n            resource: `dataContext[${dataContextName}].collection[${mergedUserCollectionName}].caseByID[${_case.case.id}]`,\n            values: {\n              values: values\n            }\n          }\n        })\n        this.props.codapPhone.call(requests, (result:any) => {\n          callback()\n        })\n      })\n    }\n\n    checkIfMergedCollectionExists((exists) => {\n      if (exists) {\n        merge()\n      }\n      else {\n        addUserAttribute(() => {\n          createMergedCollection(() => {\n            moveUserAttribute(() => {\n              createEmailAttribute(() => {\n                setUserAndEmailAttribute(() => {\n                  merge()\n                })\n              })\n            })\n          })\n        })\n      }\n    });\n  }\n\n  handleCopy() {\n    this.setState({copyState: \"Copying...\"})\n\n    const addItemValues = (item:any, row:any) => {\n      Object.keys(item.values).forEach((key) => {\n        row[key] = item.values[key]\n      })\n    }\n\n    const addParentValues = (item:any, row:any) => {\n      if (item.parent) {\n        addParentValues(item.parent, row)\n        addItemValues(item.parent, row)\n      }\n    }\n\n    const addToRows = (item:any, rows:any[]) => {\n      if (Object.keys(item.children).length !== 0) {\n        Object.keys(item.children).forEach((id) => {\n          addToRows(item.children[id], rows)\n        })\n      }\n      else {\n        const row:any = {}\n        addParentValues(item, row)\n        addItemValues(item, row)\n        rows.push(row)\n      }\n    }\n\n    // create tables for each top level collection\n    const tables:string[] = []\n    Object.keys(this.tree).forEach((id) => {\n      const rows:any[] = []\n      addToRows(this.tree[id], rows)\n\n      if (rows.length > 0) {\n        const tableHeader = Object.keys(rows[0]).map((col:any) => {\n          return `<th>${col}</th>`\n        }).join(\"\")\n        const tableRows = rows.map((row:any) => {\n          const tds = Object.keys(row).map((col:any) => {\n            return `<td>${row[col]}</td>`\n          }).join(\"\")\n          return `<tr>${tds}</tr>`\n        }).join(\"\")\n        tables.push(`<table width='100%'><thead><tr>${tableHeader}</tr></thead><tbody>${tableRows}</tbody></table>`)\n      }\n\n      // copy to clipboard\n      const content = tables.join(\"\")\n      let copied = false\n      let selection, range, mark\n      try {\n        mark = document.createElement(\"mark\")\n        mark.innerHTML = content\n        document.body.appendChild(mark)\n\n        selection = document.getSelection()\n        selection.removeAllRanges()\n\n        range = document.createRange()\n        range.selectNode(mark)\n        selection.addRange(range)\n\n        copied = document.execCommand(\"copy\")\n      }\n      catch (e) {\n        try {\n          (window as any).clipboardData.setData(\"text\", content)\n          copied = true\n        }\n        catch (e) {\n          copied = false\n        }\n      }\n      finally {\n        if (selection) {\n          if (range && (typeof selection.removeRange === \"function\")) {\n            selection.removeRange(range)\n          }\n          else {\n            selection.removeAllRanges()\n          }\n        }\n        if (mark) {\n          document.body.removeChild(mark)\n        }\n\n        this.setState({copyState: copied ? \"Copied\" : \"Could not copy!\"})\n        setTimeout(() => {\n          this.setState({copyState: null})\n        }, 2000)\n      }\n    })\n  }\n\n  renderOptions() {\n    if (!this.state.showOptions) {\n      return null\n    }\n    if (!this.state.dataContext) {\n      return (\n        <div className=\"user-interactive-datacontext-options\">\n          Loading data...\n        </div>\n      )\n    }\n    return (\n      <div className=\"user-interactive-datacontext-options\">\n        <div className=\"user-interactive-merge-datacontext user-interactive-option\" onClick={this.handleMerge}>Merge Into My Document</div>\n        {this.state.mergeState ? <div className=\"user-interactive-action-state\">{this.state.mergeState}</div> : null}\n        <div className=\"user-interactive-copy-datacontext user-interactive-option\" onClick={this.handleCopy}>Copy To Clipboard</div>\n        {this.state.copyState ? <div className=\"user-interactive-action-state\">{this.state.copyState}</div> : null}\n      </div>\n    )\n  }\n\n  render() {\n    return (\n      <div>\n        <div className=\"user-interactive-datacontext\" onClick={this.toggleShowOptions}>{this.props.dataContextName} #{this.props.version}</div>\n        {this.renderOptions()}\n      </div>\n    )\n  }\n}\n\nexport class IFrameSidebar extends React.Component<IFrameSidebarProps, IFrameSidebarState> {\n  private interactiveRef:any\n  private userInteractivesRef:any\n  private classInfo:ClassInfo\n  private classroomRef:any\n\n  constructor(props: IFrameSidebarProps) {\n    super(props)\n\n    this.onPublish = this.onPublish.bind(this)\n    this.state = {\n      error: null,\n      classHash: null,\n      publishing: false,\n      publishingError: null,\n      publishingStatus: null,\n      userInteractives: [],\n      myEmail: this.props.initInteractiveData.authInfo.email\n    }\n\n    this.classInfo = new ClassInfo(this.props.initInteractiveData.classInfoUrl || \"\")\n  }\n\n  componentWillMount() {\n    this.classInfo.getClassInfo((err, info) => {\n      if (err) {\n        this.setState({error: err})\n        return\n      }\n\n      this.setState({\n        classHash: info.classHash\n      })\n\n      const refName = `classes/${info.classHash}`\n      this.classroomRef = firebase.database().ref(refName)\n      this.classroomRef.on(\"value\", (snapshot:any) => {\n        const firebaseData:FirebaseData = snapshot.val()\n        const publishedUserInteractives:PublishedUserInteractives[] = []\n        const interactiveKey = `interactive_${this.props.initInteractiveData.interactive.id}`\n\n        const sortUserInteractives = (a: FirebaseUserInteractive, b: FirebaseUserInteractive):number => {\n          return b.createdAt - a.createdAt\n        }\n\n        if (firebaseData) {\n\n          let usernameNotFound = false\n\n          Object.keys(firebaseData.users || {}).forEach((email) => {\n            const interactive = (firebaseData.users[email].interactives || {})[interactiveKey]\n            if (interactive) {\n              const userInteractives:FirebaseUserInteractive[] = []\n              const user = this.classInfo.getUserName(email)\n              usernameNotFound = usernameNotFound || !user.found\n              Object.keys(interactive).forEach((publishKey) => {\n                userInteractives.push(interactive[publishKey])\n              })\n              if (userInteractives.length > 0) {\n                publishedUserInteractives.push({\n                  email: email,\n                  name: user.name,\n                  type: \"student\",\n                  userInteractives: userInteractives.sort(sortUserInteractives)\n                })\n              }\n            }\n          })\n\n          if (usernameNotFound) {\n            this.classInfo.getStudentNames((err, names) => {\n              if (!err) {\n                const userInteractives = this.state.userInteractives.slice()\n                userInteractives.forEach((userInteractive) => {\n                  userInteractive.name = this.classInfo.getUserName(userInteractive.email).name\n                })\n              }\n            })\n          }\n        }\n\n        this.setState({userInteractives: publishedUserInteractives})\n      })\n    })\n  }\n\n  saveDataContexts(userDataContextsKey: string, callback: (err:string|null, dataContextMap?: FirebaseDataContextRefMap) => void) {\n    this.props.codapPhone.call({\n      action: 'get',\n      resource: 'dataContextList'\n    }, (result:any) => {\n      result = result || {success: false, values: {error: \"Unable to get list of data contexts!\"}}\n      if (!result.success) {\n        return callback(result.values.error)\n      }\n\n      const dataContexts:any[] = []\n      const uniqueDataContextNames:string[] = []\n      const collectionRequests:any[] = []\n      result.values.forEach((value:any) => {\n        // ignore duplicate context names (generated from ill behaving DIs)\n        if (uniqueDataContextNames.indexOf(value.name) !== -1) {\n          return\n        }\n        uniqueDataContextNames.push(value.name)\n\n        dataContexts.push({\n          name: value.name,\n          title: value.title,\n          collections: {},\n          cases: {},\n          mergedCollection: 0\n        })\n        collectionRequests.push({\n          action: \"get\",\n          resource: `dataContext[${value.name}].collectionList`\n        })\n      })\n\n      this.props.codapPhone.call(collectionRequests, (results:any) => {\n        results = results || [{success: false, values: {error: \"Unable to get list of collections!\"}}]\n        let error:string|null = null\n\n        const dataContextForRequest:any[] = []\n        const caseRequests:any[] = []\n        results.forEach((result:any, dataContextIndex:number) => {\n          if (error || !result.success) {\n            error = error || result.values.error\n            return\n          }\n          const dataContext = dataContexts[dataContextIndex]\n          result.values.forEach((value:any, requestIndex:number) => {\n            dataContext.collections[value.id] = {\n              name: value.name,\n              title: value.title\n            }\n            if (value.name === mergedUserCollectionName) {\n              dataContext.mergedCollection = value.id\n            }\n            dataContextForRequest.push(dataContext)\n            caseRequests.push({\n              action: \"get\",\n              resource: `dataContext[${dataContext.name}].collection[${value.name}].allCases`\n            })\n          })\n        })\n\n        if (error) {\n          return callback(error)\n        }\n\n        this.props.codapPhone.call(caseRequests, (results:any) => {\n          results = results || [{success: false, values: {error: \"Unable to get case data!\"}}]\n          let error:string|null = null\n\n          results.forEach((result:any, requestIndex:number) => {\n            if (error || !result.success) {\n              error = error || result.values.error\n              return\n            }\n\n            const dataContext = dataContextForRequest[requestIndex]\n            const collectionId = result.values.collection.id\n            result.values.cases.forEach((_case:any) => {\n              if (_case.hasOwnProperty('caseIndex')) {\n                dataContext.cases[_case.case.id] = {\n                  parent: _case.case.parent || null,\n                  values: _case.case.values,\n                  collection: collectionId\n                }\n              }\n            })\n          })\n\n          const dataContextMap:FirebaseDataContextRefMap = {}\n          const userDataContextsRef = firebase.database().ref(userDataContextsKey)\n\n          dataContexts.forEach((dataContext) => {\n            if (dataContext.mergedCollection) {\n              // remove merged collection and all data not associated with the current user\n              const checkIfCurrentUserCase = (_case:any):any => {\n                if (_case.collection === dataContext.mergedCollection) {\n                  return {\n                    isCurrentUserCase: _case.values[mergedEmailAttributeName] === this.state.myEmail,\n                    collection: _case.collection\n                  }\n                }\n                if (!_case.parent) {\n                  return {\n                    isCurrentUserCase: true,\n                    collection: 0\n                  }\n                }\n                return checkIfCurrentUserCase(dataContext.cases[_case.parent])\n              }\n\n              const userCases:any = {}\n              Object.keys(dataContext.cases).forEach((caseId) => {\n                const _case = dataContext.cases[caseId]\n                if (_case.collection !== dataContext.mergedCollection) {\n                  const check = checkIfCurrentUserCase(_case)\n                  if (check.isCurrentUserCase) {\n                    if (check.collection === dataContext.mergedCollection) {\n                      _case.parent = null\n                    }\n                    userCases[caseId] = _case\n                  }\n                }\n              })\n              dataContext.cases = userCases\n              delete dataContext.collections[dataContext.mergedCollection]\n            }\n\n            const userDataContextRef = userDataContextsRef.push()\n            userDataContextRef.set(JSON.stringify(dataContext))\n            dataContextMap[userDataContextRef.key] = dataContext.title || dataContext.name\n          })\n\n          callback(error, dataContextMap)\n        })\n      })\n    })\n  }\n\n  onPublish(e:React.MouseEvent<HTMLButtonElement>) {\n    e.preventDefault()\n\n    if (!this.props.initInteractiveData) {\n      return\n    }\n\n    this.setState({\n      publishing: true,\n      publishingStatus: \"Publishing...\"\n    })\n\n    const data = this.props.initInteractiveData\n    const classroomKey = `classes/${this.state.classHash}`\n    const safeUserKey = escapeFirebaseKey(data.authInfo.email)\n    const interactiveKey = `${classroomKey}/interactives/interactive_${data.interactive.id}`\n    const userInteractivesKey = `${classroomKey}/users/${safeUserKey}/interactives/interactive_${data.interactive.id}`\n    const userDataContextsKey = `dataContexts/${this.state.classHash}/${safeUserKey}/interactive_${data.interactive.id}`\n\n    superagent\n      .post(this.props.copyUrl)\n      .set('Accept', 'application/json')\n      .end((err:any, res:any) => {\n        this.setState({\n          publishingError: null,\n          publishing: false\n        })\n\n        if (!err && this.props.authoredState) {\n          try {\n            const copyResults:CopyResults = JSON.parse(res.text)\n            if (copyResults && copyResults.id && copyResults.readAccessKey) {\n              const laraParams = {\n                recordid: copyResults.id,\n                accessKeys: {\n                  readOnly: copyResults.readAccessKey\n                }\n              }\n              const documentUrl = `${this.props.authoredState.codapUrl}?#file=lara:${base64url.encode(JSON.stringify(laraParams))}`\n\n              this.saveDataContexts(userDataContextsKey, (err, dataContexts) => {\n                if (err) {\n                  throw err\n                }\n\n                // save the interactive name (noop after it is first set)\n                const firebaseInteractive:FirebaseInteractive = {name: data.interactive.name}\n                this.interactiveRef = this.interactiveRef || firebase.database().ref(interactiveKey)\n                this.interactiveRef.set(firebaseInteractive)\n\n                // push the copy\n                this.userInteractivesRef = this.userInteractivesRef || firebase.database().ref(userInteractivesKey)\n                const userInteractive:FirebaseUserInteractive = {\n                  createdAt: firebase.database.ServerValue.TIMESTAMP,\n                  documentUrl: documentUrl,\n                  dataContexts: dataContexts || {}\n                }\n                this.userInteractivesRef.push().set(userInteractive)\n\n                this.setState({\n                  publishing: false,\n                  publishingStatus: \"Published!\"\n                })\n                const clearPublishingStatus = () => {\n                  this.setState({\n                    publishingStatus: null\n                  })\n                }\n                setTimeout(clearPublishingStatus, 2000)\n              })\n            }\n            else {\n              err = \"Invalid response from copy document call\"\n            }\n          }\n          catch (e) {\n            err = e\n          }\n        }\n\n        if (err) {\n          this.setState({publishingError: err})\n        }\n      });\n  }\n\n  renderPublishingError() {\n    if (!this.state.publishingError) {\n      return null\n    }\n    return <div className=\"error\">{this.state.publishingError}</div>\n  }\n\n  renderPublishingStatus() {\n    if (!this.state.publishingStatus) {\n      return null\n    }\n    return <div className=\"status\">{this.state.publishingStatus}</div>\n  }\n\n  renderUserInteractives() {\n    if ((this.state.classHash === null) || (this.state.userInteractives.length === 0)) {\n      return null\n    }\n\n    return (\n      <div className=\"user-interactive-list\">\n        { this.state.userInteractives.map((userInteractives) => {\n          return (\n            <UserInteractives\n              key={userInteractives.email}\n              userInteractives={userInteractives}\n              classHash={this.state.classHash || \"\"}\n              interactiveId={this.props.initInteractiveData.interactive.id}\n              email={userInteractives.email}\n              codapPhone={this.props.codapPhone}\n              initInteractiveData={this.props.initInteractiveData}\n              myEmail={this.state.myEmail}\n              classInfo={this.classInfo}\n            />\n          )\n        })\n        }\n      </div>\n    )\n  }\n\n  renderUsernameHeader() {\n    var me = this.classInfo.getUserName(this.state.myEmail)\n    var username = me.found ? me.name : null;\n    if (!username) {\n      return null;\n    }\n    return <div className=\"username-header\">{username}</div>\n  }\n\n  render() {\n    if (this.state.error) {\n      return <div id=\"iframe-sidebar\">{this.state.error}</div>\n    }\n\n    if (!this.state.classHash || !this.props.codapPhone) {\n      return null;\n    }\n\n    // const href = `../dashboard/?class=${base64url.encode(this.props.initInteractiveData.classInfoUrl)}`\n    //            <a className=\"button button-primary\" href={href} target=\"_blank\">View</a>\n    return <div id=\"iframe-sidebar\">\n             { this.renderUsernameHeader() }\n             <div className=\"buttons\">\n               <button className=\"button button-primary\" onClick={this.onPublish} disabled={this.state.publishing}>Publish</button>\n             </div>\n             { this.renderPublishingError() }\n             { this.renderPublishingStatus() }\n             { this.renderUserInteractives() }\n           </div>\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/components/iframe-sidebar.tsx"],"sourceRoot":""}